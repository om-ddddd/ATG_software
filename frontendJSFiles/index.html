<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impedance Characteristic Plots</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .grid .tick line {
            stroke: #e2e8f0; /* slate-200 */
            stroke-dasharray: 2,2;
        }
        .axis path, .axis line {
            stroke: #475569; /* slate-600 */
        }
        .axis text {
            fill: #475569; /* slate-600 */
            font-size: 12px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            background: #1e293b; /* slate-800 */
            color: #f8fafc; /* slate-50 */
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .plot-line {
            fill: none;
            stroke-width: 2px;
        }
        .plot-dot {
            stroke: white;
            stroke-width: 1.5px;
        }
        .axis-label {
            font-size: 14px;
            fill: #334155; /* slate-700 */
            font-weight: 500;
        }
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            fill: #1e293b; /* slate-800 */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-slate-800 text-center mb-12">Component Impedance Characteristics</h1>

        <!-- Component Sections -->
        <div id="plot-sections" class="space-y-16">
            <!-- Resistor Section -->
            <section id="resistor-section">
                <h2 class="text-2xl font-bold text-slate-700 text-center mb-8">Resistor</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" data-component="resistor">
                    <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="magnitude"></div>
                    <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="phase"></div>
                </div>
            </section>

            <!-- Inductor Section -->
            <section id="inductor-section">
                <h2 class="text-2xl font-bold text-slate-700 text-center mb-8">Inductor</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" data-component="inductor">
                     <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="magnitude"></div>
                    <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="phase"></div>
                </div>
            </section>

            <!-- Ceramic Capacitor Section -->
            <section id="cap-ceramic-section">
                <h2 class="text-2xl font-bold text-slate-700 text-center mb-8">Ceramic Capacitor</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" data-component="cap-ceramic">
                     <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="magnitude"></div>
                    <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="phase"></div>
                </div>
            </section>

            <!-- Electrolytic Capacitor Section -->
            <section id="cap-electrolytic-section">
                <h2 class="text-2xl font-bold text-slate-700 text-center mb-8">Electrolytic Capacitor</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" data-component="cap-electrolytic">
                     <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="magnitude"></div>
                    <div class="chart-container bg-white p-4 rounded-xl shadow-lg" data-plot-type="phase"></div>
                </div>
            </section>
        </div>
    </div>

    <div class="tooltip"></div>

    <script>
        // --- DATA ---
        const datasets = {
            resistor: {
                name: "Resistor",
                color: "#ef4444", // red-500
                data: `
                    1.00000e+06 9.85466e+03 -1.14576e+00
                    7.69231e+05 9.86921e+03 -9.55485e-01
                    5.91716e+05 9.86426e+03 -6.97125e-01
                    4.55166e+05 9.87176e+03 -5.83704e-01
                    3.50128e+05 9.86813e+03 -4.57769e-01
                    2.69329e+05 9.86651e+03 -3.53882e-01
                    2.07176e+05 9.86733e+03 -2.72049e-01
                    1.59366e+05 9.90465e+03 -1.54624e-01
                    1.22590e+05 9.90792e+03 -1.26983e-01
                    9.42996e+04 9.90695e+03 -9.38101e-02
                    7.25381e+04 9.90468e+03 -7.13930e-02
                    5.57986e+04 9.90377e+03 -5.86466e-02
                    4.29220e+04 9.90222e+03 -2.72650e-02
                    3.30169e+04 9.90194e+03 6.88737e-03
                    2.53976e+04 9.86917e+03 -2.78679e-02
                    1.95366e+04 9.86890e+03 -2.10205e-02
                    1.50282e+04 9.86870e+03 -1.79953e-02
                    1.15601e+04 9.86873e+03 -1.39243e-02
                    8.89241e+03 9.86866e+03 -9.34261e-03
                    6.84032e+03 9.86865e+03 -6.37085e-03
                    5.26178e+03 9.86861e+03 -3.75221e-03
                    4.04753e+03 9.86830e+03 -2.66686e-03
                    3.11348e+03 9.86836e+03 -3.00706e-03
                    2.39499e+03 9.86820e+03 -3.86081e-03
                    1.84230e+03 9.86830e+03 -4.55489e-03
                    1.41715e+03 9.82724e+03 -1.60009e-02
                    1.09012e+03 9.81942e+03 2.90801e-03
                    8.38551e+02 9.81942e+03 2.06974e-03
                    6.45039e+02 9.81962e+03 1.35476e-03
                    4.96184e+02 9.81982e+03 8.00775e-04
                    3.81680e+02 9.81993e+03 2.45101e-04
                    2.93600e+02 9.82002e+03 -2.42881e-04
                    2.25846e+02 9.82014e+03 -5.11286e-04
                    1.73728e+02 9.82027e+03 -3.84232e-04
                    1.33637e+02 9.82030e+03 -6.45565e-04
                    1.02798e+02 9.82036e+03 -8.22006e-04
                    7.90750e+01 9.82053e+03 -9.36257e-04
                    6.08269e+01 9.82059e+03 -1.14078e-03
                    4.67900e+01 9.82057e+03 -1.04031e-03
                    3.59923e+01 9.82077e+03 -1.43499e-03
                    2.76864e+01 9.82085e+03 -1.42276e-03
                    2.12972e+01 9.82086e+03 -1.40266e-03
                    1.63825e+01 9.82087e+03 -6.52877e-04
                    1.26019e+01 9.82084e+03 1.11994e-04
                    9.69376e+00 9.82081e+03 5.13010e-04
                    7.45674e+00 9.82079e+03 7.78212e-04
                    5.73596e+00 9.82073e+03 8.25343e-04
                    4.41227e+00 9.82068e+03 8.37599e-04
                    3.39406e+00 9.82069e+03 6.84501e-04
                    2.61081e+00 9.82068e+03 3.80464e-04
                    2.00832e+00 9.82073e+03 -1.25248e-04
                    1.54486e+00 9.82080e+03 -4.01731e-04
                    1.18835e+00 9.82094e+03 -2.55962e-04
                    1.00000e+00 9.82096e+03 -1.92810e-04`
            },
            inductor: {
                name: "Inductor",
                color: "#22c55e", // green-500
                data: `
                    1.00000e+06 5.54032e+02 8.91781e+01
                    7.69231e+05 4.23575e+02 8.91794e+01
                    5.91716e+05 3.24721e+02 8.91134e+01
                    4.55166e+05 2.49351e+02 8.89955e+01
                    3.50128e+05 1.91893e+02 8.88405e+01
                    2.69329e+05 1.47920e+02 8.86180e+01
                    2.07176e+05 1.14085e+02 8.83207e+01
                    1.59366e+05 8.81419e+01 8.79378e+01
                    1.22590e+05 6.80757e+01 8.74802e+01
                    9.42996e+04 5.26325e+01 8.68836e+01
                    7.25381e+04 4.07096e+01 8.61463e+01
                    5.57986e+04 3.15131e+01 8.52082e+01
                    4.29220e+04 2.44050e+01 8.40936e+01
                    3.30169e+04 1.89361e+01 8.27094e+01
                    2.53976e+04 1.47413e+01 8.09939e+01
                    1.95366e+04 1.15142e+01 7.88187e+01
                    1.50282e+04 9.03192e+00 7.61742e+01
                    1.15601e+04 7.12680e+00 7.29988e+01
                    8.89241e+03 5.67209e+00 6.92184e+01
                    6.84032e+03 4.56989e+00 6.47827e+01
                    5.26178e+03 3.73546e+00 5.96344e+01
                    4.04753e+03 3.11254e+00 5.38212e+01
                    3.11348e+03 2.65552e+00 4.74848e+01
                    2.39499e+03 2.32785e+00 4.08538e+01
                    1.84230e+03 2.09942e+00 3.42867e+01
                    1.41715e+03 1.94244e+00 2.80973e+01
                    1.09012e+03 1.83934e+00 2.26409e+01
                    8.38551e+02 1.77417e+00 1.79732e+01
                    6.45039e+02 1.73292e+00 1.41235e+01
                    4.96184e+02 1.70702e+00 1.10198e+01
                    3.81680e+02 1.69084e+00 8.55783e+00
                    2.93600e+02 1.68076e+00 6.62566e+00
                    2.25846e+02 1.67445e+00 5.11931e+00
                    1.73728e+02 1.67047e+00 3.94969e+00
                    1.33637e+02 1.66792e+00 3.04581e+00
                    1.02798e+02 1.66627e+00 2.34771e+00
                    7.90750e+01 1.66524e+00 1.80846e+00
                    6.08269e+01 1.66456e+00 1.39276e+00
                    4.67900e+01 1.66411e+00 1.07204e+00
                    3.59923e+01 1.66379e+00 8.26056e-01
                    2.76864e+01 1.66358e+00 6.36171e-01
                    2.12972e+01 1.66350e+00 4.89952e-01
                    1.63825e+01 1.66342e+00 3.76963e-01
                    1.26019e+01 1.66336e+00 2.90123e-01
                    9.69376e+00 1.66330e+00 2.23302e-01
                    7.45674e+00 1.66317e+00 1.71706e-01
                    5.73596e+00 1.66311e+00 1.32329e-01
                    4.41227e+00 1.66306e+00 1.01476e-01
                    3.39406e+00 1.66297e+00 7.80470e-02
                    2.61081e+00 1.66291e+00 5.98591e-02
                    2.00832e+00 1.66286e+00 4.63460e-02
                    1.54486e+00 1.66284e+00 3.63767e-02
                    1.18835e+00 1.66280e+00 2.78804e-02
                    1.00000e+00 1.66287e+00 2.36538e-02`
            },
            'cap-ceramic': {
                name: "Ceramic Capacitor",
                color: "#f97316", // orange-500
                data: `
                    1.00000e+06 1.50590e+01 -8.63869e+01
                    7.69231e+05 2.00819e+01 -8.71274e+01
                    5.91716e+05 2.64393e+01 -8.76712e+01
                    4.55166e+05 3.46425e+01 -8.80547e+01
                    3.50128e+05 4.51564e+01 -8.83573e+01
                    2.69329e+05 5.87344e+01 -8.85849e+01
                    2.07176e+05 7.63443e+01 -8.87343e+01
                    1.59366e+05 9.91588e+01 -8.88750e+01
                    1.22590e+05 1.28997e+02 -8.89801e+01
                    9.42996e+04 1.67355e+02 -8.90541e+01
                    7.25381e+04 2.17120e+02 -8.91184e+01
                    5.57986e+04 2.81700e+02 -8.91749e+01
                    4.29220e+04 3.65459e+02 -8.92296e+01
                    3.30169e+04 4.74183e+02 -8.92897e+01
                    2.53976e+04 6.15316e+02 -8.93527e+01
                    1.95366e+04 7.98463e+02 -8.94064e+01
                    1.50282e+04 1.03628e+03 -8.94090e+01
                    1.15601e+04 1.34483e+03 -8.94471e+01
                    8.89241e+03 1.74563e+03 -8.94879e+01
                    6.84032e+03 2.26618e+03 -8.95277e+01
                    5.26178e+03 2.94220e+03 -8.95639e+01
                    4.04753e+03 3.82030e+03 -8.96006e+01
                    3.11348e+03 4.96107e+03 -8.96344e+01
                    2.39499e+03 6.44300e+03 -8.96687e+01
                    1.84230e+03 8.36922e+03 -8.96985e+01
                    1.41715e+03 1.08680e+04 -8.97134e+01
                    1.09012e+03 1.40855e+04 -8.97427e+01
                    8.38551e+02 1.83437e+04 -8.97733e+01
                    6.45039e+02 2.38329e+04 -8.97953e+01
                    4.96184e+02 3.09676e+04 -8.98157e+01
                    3.81680e+02 4.02390e+04 -8.98341e+01
                    2.93600e+02 5.22845e+04 -8.98447e+01
                    2.25846e+02 6.79436e+04 -8.98597e+01
                    1.73728e+02 8.84834e+04 -8.98709e+01
                    1.33637e+02 1.14755e+05 -8.98831e+01
                    1.02798e+02 1.48790e+05 -8.98928e+01
                    7.90750e+01 1.93840e+05 -8.99026e+01
                    6.08269e+01 2.51934e+05 -8.99107e+01
                    4.67900e+01 3.27452e+05 -8.99156e+01
                    3.59923e+01 4.25594e+05 -8.99238e+01
                    2.76864e+01 5.53117e+05 -8.99243e+01
                    2.12972e+01 7.18908e+05 -8.99287e+01
                    1.63825e+01 9.34432e+05 -8.99312e+01
                    1.26019e+01 1.21457e+06 -8.99358e+01
                    9.69376e+00 1.57496e+06 -8.99372e+01
                    7.45674e+00 2.05203e+06 -8.99388e+01
                    5.73596e+00 2.66736e+06 -8.99427e+01
                    4.41227e+00 3.46688e+06 -8.99421e+01
                    3.39406e+00 4.50609e+06 -8.99425e+01
                    2.61081e+00 5.85673e+06 -8.99440e+01
                    2.00832e+00 7.61230e+06 -8.99394e+01
                    1.54486e+00 9.89491e+06 -8.99443e+01
                    1.18835e+00 1.28611e+07 -8.99455e+01
                    1.00000e+00 1.52463e+07 -8.99457e+01`
            },
            'cap-electrolytic': {
                name: "Electrolytic Capacitor",
                color: "#3b82f6", // blue-500
                data: `
                    1.00000e+06 1.93109e+00 3.52884e+01
                    7.69231e+05 1.77576e+00 3.01516e+01
                    5.91716e+05 1.66136e+00 2.63618e+01
                    4.55166e+05 1.56007e+00 2.27380e+01
                    3.50128e+05 1.46927e+00 1.98892e+01
                    2.69329e+05 1.37621e+00 1.68412e+01
                    2.07176e+05 1.28021e+00 1.33416e+01
                    1.59366e+05 1.18955e+00 8.50152e+00
                    1.22590e+05 1.11097e+00 1.63170e+00
                    9.42996e+04 1.07267e+00 -7.11153e+00
                    7.25381e+04 1.08335e+00 -1.75921e+01
                    5.57986e+04 1.15523e+00 -2.84003e+01
                    4.29220e+04 1.30035e+00 -3.89088e+01
                    3.30169e+04 1.52675e+00 -4.80568e+01
                    2.53976e+04 1.84555e+00 -5.58627e+01
                    1.95366e+04 2.27569e+00 -6.23294e+01
                    1.50282e+04 2.84451e+00 -6.76042e+01
                    1.15601e+04 3.59393e+00 -7.18725e+01
                    8.89241e+03 4.57458e+00 -7.52921e+01
                    6.84032e+03 5.84588e+00 -7.80187e+01
                    5.26178e+03 7.49854e+00 -8.02016e+01
                    4.04753e+03 9.63909e+00 -8.19458e+01
                    3.11348e+03 1.24095e+01 -8.33479e+01
                    2.39499e+03 1.60058e+01 -8.44732e+01
                    1.84230e+03 2.06635e+01 -8.53738e+01
                    1.41715e+03 2.66820e+01 -8.61049e+01
                    1.09012e+03 3.44665e+01 -8.66362e+01
                    8.38551e+02 4.45827e+01 -8.70644e+01
                    6.45039e+02 5.74775e+01 -8.73969e+01
                    4.96184e+02 7.43566e+01 -8.76635e+01
                    3.81680e+02 9.61984e+01 -8.78854e+01
                    2.93600e+02 1.24779e+02 -8.80793e+01
                    2.25846e+02 1.61494e+02 -8.82507e+01
                    1.73728e+02 2.08578e+02 -8.84045e+01
                    1.33637e+02 2.70099e+02 -8.85459e+01
                    1.02798e+02 3.49884e+02 -8.86756e+01
                    7.90750e+01 4.53415e+02 -8.87943e+01
                    6.08269e+01 5.87731e+02 -8.89026e+01
                    4.67900e+01 7.62064e+02 -8.89968e+01
                    3.59923e+01 9.88348e+02 -8.90771e+01
                    2.76864e+01 1.28471e+03 -8.91432e+01
                    2.12972e+01 1.66669e+03 -8.92012e+01
                    1.63825e+01 2.15739e+03 -8.92486e+01
                    1.26019e+01 2.79947e+03 -8.92885e+01
                    9.69376e+00 3.63307e+03 -8.93207e+01
                    7.45674e+00 4.71515e+03 -8.93443e+01
                    5.73596e+00 6.15218e+03 -8.93609e+01
                    4.41227e+00 7.98490e+03 -8.93715e+01
                    3.39406e+00 1.03853e+04 -8.93768e+01
                    2.61081e+00 1.34787e+04 -8.93774e+01
                    2.00832e+00 1.74931e+04 -8.93733e+01
                    1.54486e+00 2.26469e+04 -8.93673e+01
                    1.18835e+00 2.93887e+04 -8.93621e+01
                    1.00000e+00 3.48827e+04 -8.93524e+01`
            }
        };

        const tooltip = d3.select(".tooltip");

        /**
         * Parses the raw data string into a structured array.
         * @param {string} rawData - The multiline string of data.
         * @returns {Array<Object>} An array of data points.
         */
        function parseData(rawData) {
            return rawData.trim().split('\n').map(line => {
                const parts = line.trim().split(/\s+/);
                return {
                    freq: parseFloat(parts[0]),
                    mag: parseFloat(parts[1]),
                    phi: parseFloat(parts[2])
                };
            }).filter(d => !isNaN(d.freq) && !isNaN(d.mag) && !isNaN(d.phi));
        }

        /**
         * Draws a single D3 chart in the specified container.
         * @param {HTMLElement} container - The DOM element to draw the chart in.
         * @param {Array<Object>} data - The parsed data array.
         * @param {string} plotType - 'magnitude' or 'phase'.
         * @param {string} componentName - The name of the component for the title.
         * @param {string} color - The hex color for the plot.
         */
        function drawChart(container, data, plotType, componentName, color) {
            const isMagnitude = plotType === 'magnitude';
            const yValue = isMagnitude ? d => d.mag : d => d.phi;
            const yLabel = isMagnitude ? "Magnitude |Z| (Ohms)" : "Phase (Deg)";
            const title = `${componentName} - ${isMagnitude ? 'Magnitude' : 'Phase'} vs. Frequency`;
            
            const svg = d3.select(container).append("svg");
            
            let resizeTimer;
            const handleResize = () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => render(), 100);
            };

            const render = () => {
                svg.selectAll("*").remove();

                const containerWidth = container.clientWidth;
                const containerHeight = containerWidth * 0.75;

                const margin = { top: 60, right: 20, bottom: 60, left: 70 };
                const width = containerWidth - margin.left - margin.right;
                const height = containerHeight - margin.top - margin.bottom;

                svg.attr("width", containerWidth).attr("height", containerHeight);

                const chart = svg.append("g")
                    .attr("transform", `translate(${margin.left}, ${margin.top})`);

                const xScale = d3.scaleLog()
                    .domain(d3.extent(data, d => d.freq))
                    .range([0, width]);

                let yScale;
                if (isMagnitude) {
                    yScale = d3.scaleLog()
                        .domain(d3.extent(data, yValue))
                        .range([height, 0]);
                } else {
                    yScale = d3.scaleLinear()
                        .range([height, 0]);
                    const [yMin, yMax] = d3.extent(data, yValue);
                    const yPadding = (yMax - yMin) * 0.1 || 1;
                    yScale.domain([yMin - yPadding, yMax + yPadding]);
                }

                const xAxis = d3.axisBottom(xScale)
                    .ticks(Math.log10(xScale.domain()[1]), ".1e")
                    .tickSizeOuter(0);

                chart.append("g")
                    .attr("class", "axis")
                    .attr("transform", `translate(0, ${height})`)
                    .call(xAxis)
                    .selectAll("text")
                    .attr("transform", "rotate(-45)")
                    .style("text-anchor", "end");

                let yAxis = d3.axisLeft(yScale);
                if (isMagnitude) {
                    yAxis.ticks(10, d3.format(".2s"));
                } else {
                    yAxis.ticks(10).tickFormat(d => d.toFixed(1));
                }

                chart.append("g").attr("class", "axis").call(yAxis);

                chart.append("g").attr("class", "grid")
                    .call(d3.axisLeft(yScale).ticks(10).tickSize(-width).tickFormat(""));

                svg.append("text").attr("class", "chart-title")
                    .attr("x", containerWidth / 2).attr("y", margin.top / 2)
                    .attr("text-anchor", "middle").text(title);

                svg.append("text").attr("class", "axis-label")
                    .attr("x", containerWidth / 2).attr("y", containerHeight - 5)
                    .attr("text-anchor", "middle").text("Frequency (Hz)");

                svg.append("text").attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -containerHeight / 2).attr("y", 20)
                    .attr("text-anchor", "middle").text(yLabel);

                const line = d3.line()
                    .x(d => xScale(d.freq))
                    .y(d => yScale(yValue(d)));

                chart.append("path")
                    .datum(data)
                    .attr("class", "plot-line")
                    .style("stroke", color)
                    .attr("d", line);

                chart.selectAll(".plot-dot")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("class", "plot-dot")
                    .style("fill", color)
                    .attr("cx", d => xScale(d.freq))
                    .attr("cy", d => yScale(yValue(d)))
                    .attr("r", 4)
                    .on("mouseover", (event, d) => {
                        tooltip.transition().style("opacity", .9);
                        const yFormatted = isMagnitude ? yValue(d).toExponential(3) : yValue(d).toFixed(4);
                        tooltip.html(`Freq: ${d.freq.toExponential(2)} Hz<br/>${isMagnitude ? 'Mag' : 'Phase'}: ${yFormatted} ${isMagnitude ? 'Ω' : '°'}`)
                            .style("left", (event.pageX + 15) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", () => {
                        tooltip.transition().style("opacity", 0);
                    });
            };
            
            render();
            window.addEventListener('resize', handleResize);
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            for (const key in datasets) {
                const component = datasets[key];
                const parsedData = parseData(component.data);
                
                const section = document.querySelector(`[data-component="${key}"]`);
                if (section) {
                    const magContainer = section.querySelector('[data-plot-type="magnitude"]');
                    const phaseContainer = section.querySelector('[data-plot-type="phase"]');

                    if (magContainer) {
                        drawChart(magContainer, parsedData, 'magnitude', component.name, component.color);
                    }
                    if (phaseContainer) {
                        drawChart(phaseContainer, parsedData, 'phase', component.name, component.color);
                    }
                }
            }
        });
    </script>
</body>
</html>
