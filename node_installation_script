# Install nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash

# Export path to environment
echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"' >> ~/.bashrc
echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"' >> ~/.bashrc

# Restart bashrc
source ~/.bashrc

# Load nvm in current session (needed if source didn't work)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Check the version of nvm
nvm --version

# Install latest node
nvm install node

# Use latest node
nvm use node

# Set it as default
nvm alias default node

# Check installation
node --version
npm --version  # Fixed: was "npm version"

# Install required node modules (only if package.json exists)
if [ -f "package.json" ]; then
    npm install
else
    echo "No package.json found, skipping npm install"
fi